"""
要件定義書品質評価用のプロンプトテンプレート

weave.StringPromptを使用してプロンプトをバージョン管理します。
Few-shot例を含む詳細な評価ルーブリックを提供します。
"""

import weave

document_quality_evaluation_prompt = weave.StringPrompt(
    """あなたは要件定義書の品質を評価する専門家です。

## 評価観点と基準

### 1. 網羅性（comprehensiveness）
ユーザー要求に必要な情報が網羅されているか

| スコア | 基準 |
|--------|------|
| 0.8-1.0 | 7セクション全て存在し、要求された全機能が記載されている |
| 0.5-0.7 | 主要セクションは存在するが、一部機能の記載漏れがある |
| 0.0-0.4 | 複数セクションが欠落、または主要機能が未記載 |

### 2. 具体性（specificity）
実装可能なレベルで具体的に記載されているか

| スコア | 基準 |
|--------|------|
| 0.8-1.0 | 数値・技術仕様・プロトコルが明記されている |
| 0.5-0.7 | 機能は列挙されているが詳細仕様が不足 |
| 0.0-0.4 | 抽象的な記述のみで実装の指針にならない |

### 3. 整合性（consistency）
セクション間で矛盾がないか

| スコア | 基準 |
|--------|------|
| 0.8-1.0 | 全セクションが論理的に整合している |
| 0.5-0.7 | 軽微な矛盾や不明確な関連性がある |
| 0.0-0.4 | セクション間で明らかな矛盾がある |

## 評価例

### 例1: 高評価（網羅性: 0.9, 具体性: 0.9, 整合性: 0.9）
**ユーザー要求**: スマートフォン向けの健康管理アプリを開発したい
**生成された要件定義書**:
```
# プロジェクト概要
健康管理機能を備えたiOS/Androidネイティブアプリ

# 主要機能
- 歩数計測: Google Fit/HealthKit連携、目標設定機能
- 食事記録: カロリー自動計算、写真からの栄養解析
- 睡眠トラッキング: REM/ノンREM分析、睡眠スコア

# 非機能要件
- レスポンス時間: 100ms以下
- 通信: TLS 1.3による暗号化
- データ保持: GDPR準拠

# 制約条件
- iOS 14以上、Android 10以上
- 1GB以上の空き容量

# ターゲットユーザー
20-50代の健康意識の高いユーザー

# 優先順位
Phase 1: 歩数計測 / Phase 2: 食事記録、睡眠

# リスクと軽減策
- データ漏洩リスク → エンドツーエンド暗号化
```
**評価理由**:
- 網羅性(0.9): 7セクション完備、要求機能を全てカバー
- 具体性(0.9): プロトコル・バージョン・数値が明記
- 整合性(0.9): Phase分けと優先順位が整合

### 例2: やや高評価（網羅性: 0.7, 具体性: 0.7, 整合性: 0.8）
**ユーザー要求**: スマートフォン向けの健康管理アプリを開発したい
**生成された要件定義書**:
```
# プロジェクト概要
健康管理アプリケーション

# 主要機能
- 歩数計測機能
- 食事記録機能（カロリー計算付き）
- 睡眠記録機能

# 非機能要件
- 高速なレスポンス
- セキュアな通信

# 制約条件
- スマートフォン対応

# ターゲットユーザー
健康に関心のあるユーザー

# 優先順位
歩数計測を最優先で実装

# リスクと軽減策
- セキュリティリスクに対して暗号化で対応
```
**評価理由**:
- 網羅性(0.7): 7セクション揃っているが、各項目の深さが不足
- 具体性(0.7): 機能は列挙されているが数値・仕様が曖昧
- 整合性(0.8): セクション間に矛盾はないが関連性が薄い

### 例3: 中評価（網羅性: 0.5, 具体性: 0.5, 整合性: 0.6）
**ユーザー要求**: オンライン学習プラットフォームを作りたい
**生成された要件定義書**:
```
# プロジェクト概要
社会人向けオンライン学習サービス

# 主要機能
- 動画配信
- 進捗管理
- 決済機能

# 非機能要件
- 複数同時配信に対応
```
**評価理由**:
- 網羅性(0.5): 4セクション欠落（制約条件、ターゲット、優先順位、リスク）
- 具体性(0.5): 「複数同時配信」の具体的な数値なし
- 整合性(0.6): 記載内容に矛盾はないが、不完全で判断困難

### 例4: やや低評価（網羅性: 0.4, 具体性: 0.4, 整合性: 0.5）
**ユーザー要求**: 飲食店の予約管理システムを開発したい
**生成された要件定義書**:
```
# プロジェクト概要
飲食店向けの予約システム

# 主要機能
- 予約管理
- 顧客情報の登録

# 非機能要件
- 使いやすいUI
```
**評価理由**:
- 網羅性(0.4): 3セクションのみ、リマインダー・カレンダー連携等が未記載
- 具体性(0.4): 機能名のみで詳細仕様なし、「使いやすい」は曖昧
- 整合性(0.5): 矛盾はないが情報不足で関連性が不明

### 例5: 低評価（網羅性: 0.2, 具体性: 0.3, 整合性: 0.3）
**ユーザー要求**: 飲食店の予約管理システムを開発したい
**生成された要件定義書**:
```
# 概要
予約システム

# 機能
- 予約ができる
```
**評価理由**:
- 網羅性(0.2): 2セクションのみ、必須情報の大半が欠落
- 具体性(0.3): 「予約ができる」では実装不可能
- 整合性(0.3): 情報不足で整合性の判断が困難

---

## 評価対象

**ユーザーの要求**
{user_request}

**期待される出力の概要**
{expected_output}

**生成された要件定義書**
{requirements_doc}

上記の基準と例を参考に、3つの観点で評価してください。"""
)


def publish_documentation_quality_prompt() -> None:
    """
    要件定義書品質評価プロンプトをWeaveに公開します。

    Weaveはコンテンツハッシュベースの重複排除を行うため、
    同じ内容であれば何度呼び出しても新バージョンは作成されません。
    """
    weave.publish(
        document_quality_evaluation_prompt, name="document_quality_evaluation_prompt"
    )
